import{a as it}from"./chunk-KLHEAIA7.js";import{a as et}from"./chunk-S2MZKOKV.js";import{Aa as R,B as g,Ba as Z,Cb as H,E as $,Ga as U,Ha as m,Hc as J,Ka as q,Kc as K,L as r,M as x,Mb as E,Nc as Q,P as F,Q as N,R as _,T as A,Ta as C,Tb as W,U as j,Ya as v,Za as z,Zb as X,_a as G,ae as tt,c as h,d as u,e as y,ea as V,fa as P,gb as B,ia as k,l as D,o as p,p as T,rc as Y,sa as f,sc as I,ta as d,x as L}from"./chunk-3TPBM5R3.js";import{a as n}from"./chunk-GAL4ENT6.js";function ot(e,l){e&1&&(v(0,"div",0),G(1,"nz-spin"),z())}function nt(e,l){}function st(e,l){if(e&1&&(v(0,"div",1),m(1,nt,0,0,"ng-template",2),z()),e&2){let t=B();f(),q("ngTemplateOutlet",t.nzToolkit)}}var O="codeEditor";function b(e){return(...l)=>{e&&e(...l)}}var w=new y(1),a="unload",rt=(()=>{class e{constructor(t){this.nzConfigService=t,this.document=j(W),this.firstEditorInitialized=!1,this.option={},this.option$=new u(this.option);let i=this.nzConfigService.getConfigForComponent(O);this.config=n({},i),this.config.monacoEnvironment&&(window.MonacoEnvironment=n({},this.config.monacoEnvironment)),this.option=this.config.defaultEditorOption||{},this.subscription=this.nzConfigService.getConfigChangeEventForComponent(O).subscribe(()=>{let o=this.nzConfigService.getConfigForComponent(O);o&&this._updateDefaultOption(o.defaultEditorOption)})}ngOnDestroy(){this.subscription.unsubscribe(),this.subscription=null}_updateDefaultOption(t){this.option=n(n({},this.option),t),this.option$.next(this.option),"theme"in t&&t.theme&&monaco.editor.setTheme(t.theme)}requestToInit(){return a==="LOADED"?(this.onInit(),D(this.getLatestOption())):(a==="unload"&&(this.config.useStaticLoading&&typeof monaco>"u"?I("You choose to use static loading but it seems that you forget to config webpack plugin correctly. Please refer to our official websitefor more details about static loading."):this.loadMonacoScript()),w.pipe(x(()=>this.onInit()),p(()=>this.getLatestOption())))}loadMonacoScript(){if(this.config.useStaticLoading){Promise.resolve().then(()=>this.onLoad());return}if(a==="loading")return;a="loading";let t=this.config.assetsRoot,i=t?`${t}/vs`:"assets/vs",o=window,s=this.document.createElement("script");s.type="text/javascript",s.src=`${i}/loader.js`;let c=()=>{S(),o.require.config(n({paths:{vs:i}},this.config.extraConfig)),o.require(["vs/editor/editor.main"],()=>{this.onLoad()})},M=()=>{throw S(),new Error(`${Y} cannot load assets of monaco editor from source "${i}".`)},S=()=>{s.removeEventListener("load",c),s.removeEventListener("error",M),this.document.documentElement.removeChild(s)};s.addEventListener("load",c),s.addEventListener("error",M),this.document.documentElement.appendChild(s)}onLoad(){a="LOADED",w.next(!0),w.complete(),b(this.config.onLoad)()}onInit(){this.firstEditorInitialized||(this.firstEditorInitialized=!0,b(this.config.onFirstEditorInit)()),b(this.config.onInit)()}getLatestOption(){return n({},this.option)}static{this.\u0275fac=function(i){return new(i||e)(A(tt))}}static{this.\u0275prov=N({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),dt=(()=>{class e{set nzEditorOption(t){this.editorOption$.next(t)}constructor(t,i,o,s){this.nzCodeEditorService=t,this.ngZone=i,this.platform=s,this.nzEditorMode="normal",this.nzOriginalText="",this.nzLoading=!1,this.nzFullControl=!1,this.nzEditorInitialized=new V,this.editorOptionCached={},this.destroy$=new h,this.resize$=new h,this.editorOption$=new u({}),this.editorInstance=null,this.value="",this.modelSet=!1,this.onDidChangeContentDisposable=null,this.onChange=c=>{},this.onTouch=()=>{},this.el=o.nativeElement,this.el.classList.add("ant-code-editor")}ngAfterViewInit(){this.platform.isBrowser&&this.nzCodeEditorService.requestToInit().pipe(r(this.destroy$)).subscribe(t=>this.setup(t))}ngOnDestroy(){this.onDidChangeContentDisposable&&(this.onDidChangeContentDisposable.dispose(),this.onDidChangeContentDisposable=null),this.editorInstance&&(this.editorInstance.dispose(),this.editorInstance=null),this.destroy$.next(),this.destroy$.complete()}writeValue(t){this.value=t,this.setValue()}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouch=t}layout(){this.resize$.next()}setup(t){this.ngZone.runOutsideAngular(()=>J().pipe(r(this.destroy$)).subscribe(()=>{this.editorOptionCached=t,this.registerOptionChanges(),this.initMonacoEditorInstance(),this.registerResizeChange(),this.setValue(),this.nzFullControl||this.setValueEmitter(),this.nzEditorInitialized.observers.length&&this.ngZone.run(()=>this.nzEditorInitialized.emit(this.editorInstance))}))}registerOptionChanges(){T([this.editorOption$,this.nzCodeEditorService.option$]).pipe(r(this.destroy$)).subscribe(([t,i])=>{this.editorOptionCached=n(n(n({},this.editorOptionCached),i),t),this.updateOptionToMonaco()})}initMonacoEditorInstance(){this.ngZone.runOutsideAngular(()=>{this.editorInstance=this.nzEditorMode==="normal"?monaco.editor.create(this.el,n({},this.editorOptionCached)):monaco.editor.createDiffEditor(this.el,n({},this.editorOptionCached))})}registerResizeChange(){K(window,"resize").pipe(g(300),r(this.destroy$)).subscribe(()=>{this.layout()}),this.resize$.pipe(r(this.destroy$),L(()=>!!this.editorInstance),p(()=>({width:this.el.clientWidth,height:this.el.clientHeight})),$((t,i)=>t.width===i.width&&t.height===i.height),g(50)).subscribe(()=>{this.editorInstance.layout()})}setValue(){if(this.editorInstance){if(this.nzFullControl&&this.value){I("should not set value when you are using full control mode! It would result in ambiguous data flow!");return}if(this.nzEditorMode==="normal")if(this.modelSet){let t=this.editorInstance.getModel();this.preservePositionAndSelections(()=>t.setValue(this.value))}else this.editorInstance.setModel(monaco.editor.createModel(this.value,this.editorOptionCached.language)),this.modelSet=!0;else if(this.modelSet){let t=this.editorInstance.getModel();this.preservePositionAndSelections(()=>{t.modified.setValue(this.value),t.original.setValue(this.nzOriginalText)})}else{let t=this.editorOptionCached.language;this.editorInstance.setModel({original:monaco.editor.createModel(this.nzOriginalText,t),modified:monaco.editor.createModel(this.value,t)}),this.modelSet=!0}}}preservePositionAndSelections(t){if(!this.editorInstance){t();return}let i=this.editorInstance.getPosition(),o=this.editorInstance.getSelections();t(),i&&this.editorInstance.setPosition(i),o&&this.editorInstance.setSelections(o)}setValueEmitter(){let t=this.nzEditorMode==="normal"?this.editorInstance.getModel():this.editorInstance.getModel().modified;this.onDidChangeContentDisposable=t.onDidChangeContent(()=>{this.emitValue(t.getValue())})}emitValue(t){this.value!==t&&(this.value=t,this.ngZone.run(()=>{this.onChange(t)}))}updateOptionToMonaco(){this.editorInstance&&this.editorInstance.updateOptions(n({},this.editorOptionCached))}static{this.\u0275fac=function(i){return new(i||e)(d(rt),d(P),d(k),d(Q))}}static{this.\u0275cmp=R({type:e,selectors:[["nz-code-editor"]],inputs:{nzEditorMode:"nzEditorMode",nzOriginalText:"nzOriginalText",nzLoading:[2,"nzLoading","nzLoading",E],nzFullControl:[2,"nzFullControl","nzFullControl",E],nzToolkit:"nzToolkit",nzEditorOption:"nzEditorOption"},outputs:{nzEditorInitialized:"nzEditorInitialized"},exportAs:["nzCodeEditor"],features:[H([{provide:et,useExisting:F(()=>e),multi:!0}]),U],decls:2,vars:2,consts:[[1,"ant-code-editor-loading"],[1,"ant-code-editor-toolkit"],[3,"ngTemplateOutlet"]],template:function(i,o){i&1&&m(0,ot,2,0,"div",0)(1,st,2,1,"div",1),i&2&&(C(o.nzLoading?0:-1),f(),C(o.nzToolkit?1:-1))},dependencies:[it,X],encapsulation:2,changeDetection:0})}}return e})(),St=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=Z({type:e})}static{this.\u0275inj=_({imports:[dt]})}}return e})();export{dt as a,St as b};
