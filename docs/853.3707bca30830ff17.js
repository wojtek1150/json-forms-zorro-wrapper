"use strict";(self.webpackChunkjson_forms=self.webpackChunkjson_forms||[]).push([[853],{2853:!1,60384:(b,I,n)=>{n.d(I,{sd:()=>M,tC:()=>V});var f=n(31635),_=n(60177),i=n(54438),P=n(84341),T=n(92771),C=n(84412),L=n(7673),m=n(21413),A=n(84572),x=n(33726),y=n(88141),O=n(96354),a=n(56977),v=n(70152),R=n(5964),B=n(23294),l=n(3451),c=n(70317),U=n(82983),K=n(16042),$=n(36860);function S(e,h){1&e&&(i.j41(0,"div",0),i.nrm(1,"nz-spin"),i.k0s())}function W(e,h){}function j(e,h){if(1&e&&(i.j41(0,"div",1),i.DNE(1,W,0,0,"ng-template",2),i.k0s()),2&e){const t=i.XpG();i.R7$(),i.Y8G("ngTemplateOutlet",t.nzToolkit)}}const u="codeEditor";function g(e){return(...h)=>{e&&e(...h)}}const E=new T.m(1);let d="unload",F=(()=>{class e{constructor(t,o){this.nzConfigService=t,this.firstEditorInitialized=!1,this.option={},this.option$=new C.t(this.option);const r=this.nzConfigService.getConfigForComponent(u);this.document=o,this.config={...r},this.config.monacoEnvironment&&(window.MonacoEnvironment={...this.config.monacoEnvironment}),this.option=this.config.defaultEditorOption||{},this.subscription=this.nzConfigService.getConfigChangeEventForComponent(u).subscribe(()=>{const s=this.nzConfigService.getConfigForComponent(u);s&&this._updateDefaultOption(s.defaultEditorOption)})}ngOnDestroy(){this.subscription.unsubscribe(),this.subscription=null}_updateDefaultOption(t){this.option={...this.option,...t},this.option$.next(this.option),"theme"in t&&t.theme&&monaco.editor.setTheme(t.theme)}requestToInit(){return"LOADED"===d?(this.onInit(),(0,L.of)(this.getLatestOption())):("unload"===d&&(this.config.useStaticLoading&&typeof monaco>"u"?(0,l.R8)("You choose to use static loading but it seems that you forget to config webpack plugin correctly. Please refer to our official websitefor more details about static loading."):this.loadMonacoScript()),E.pipe((0,y.M)(()=>this.onInit()),(0,O.T)(()=>this.getLatestOption())))}loadMonacoScript(){if(this.config.useStaticLoading)return void Promise.resolve().then(()=>this.onLoad());if("loading"===d)return;d="loading";const t=this.config.assetsRoot,o=t?`${t}/vs`:"assets/vs",r=window,s=this.document.createElement("script");s.type="text/javascript",s.src=`${o}/loader.js`;const p=()=>{z(),r.require.config({paths:{vs:o},...this.config.extraConfig}),r.require(["vs/editor/editor.main"],()=>{this.onLoad()})},D=()=>{throw z(),new Error(`${l.H3} cannot load assets of monaco editor from source "${o}".`)},z=()=>{s.removeEventListener("load",p),s.removeEventListener("error",D),this.document.documentElement.removeChild(s)};s.addEventListener("load",p),s.addEventListener("error",D),this.document.documentElement.appendChild(s)}onLoad(){d="LOADED",E.next(!0),E.complete(),g(this.config.onLoad)()}onInit(){this.firstEditorInitialized||(this.firstEditorInitialized=!0,g(this.config.onFirstEditorInit)()),g(this.config.onInit)()}getLatestOption(){return{...this.option}}static#t=this.\u0275fac=function(o){return new(o||e)(i.KVO(K.yx),i.KVO(_.qQ))};static#i=this.\u0275prov=i.jDH({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),M=(()=>{class e{set nzEditorOption(t){this.editorOption$.next(t)}constructor(t,o,r,s){this.nzCodeEditorService=t,this.ngZone=o,this.platform=s,this.nzEditorMode="normal",this.nzOriginalText="",this.nzLoading=!1,this.nzFullControl=!1,this.nzEditorInitialized=new i.bkB,this.editorOptionCached={},this.destroy$=new m.B,this.resize$=new m.B,this.editorOption$=new C.t({}),this.editorInstance=null,this.value="",this.modelSet=!1,this.onDidChangeContentDisposable=null,this.onChange=p=>{},this.onTouch=()=>{},this.el=r.nativeElement,this.el.classList.add("ant-code-editor")}ngAfterViewInit(){this.platform.isBrowser&&this.nzCodeEditorService.requestToInit().pipe((0,a.Q)(this.destroy$)).subscribe(t=>this.setup(t))}ngOnDestroy(){this.onDidChangeContentDisposable&&(this.onDidChangeContentDisposable.dispose(),this.onDidChangeContentDisposable=null),this.editorInstance&&(this.editorInstance.dispose(),this.editorInstance=null),this.destroy$.next(),this.destroy$.complete()}writeValue(t){this.value=t,this.setValue()}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouch=t}layout(){this.resize$.next()}setup(t){this.ngZone.runOutsideAngular(()=>(0,c.ij)().pipe((0,a.Q)(this.destroy$)).subscribe(()=>{this.editorOptionCached=t,this.registerOptionChanges(),this.initMonacoEditorInstance(),this.registerResizeChange(),this.setValue(),this.nzFullControl||this.setValueEmitter(),this.nzEditorInitialized.observers.length&&this.ngZone.run(()=>this.nzEditorInitialized.emit(this.editorInstance))}))}registerOptionChanges(){(0,A.z)([this.editorOption$,this.nzCodeEditorService.option$]).pipe((0,a.Q)(this.destroy$)).subscribe(([t,o])=>{this.editorOptionCached={...this.editorOptionCached,...o,...t},this.updateOptionToMonaco()})}initMonacoEditorInstance(){this.ngZone.runOutsideAngular(()=>{this.editorInstance="normal"===this.nzEditorMode?monaco.editor.create(this.el,{...this.editorOptionCached}):monaco.editor.createDiffEditor(this.el,{...this.editorOptionCached})})}registerResizeChange(){this.ngZone.runOutsideAngular(()=>{(0,x.R)(window,"resize").pipe((0,v.B)(300),(0,a.Q)(this.destroy$)).subscribe(()=>{this.layout()}),this.resize$.pipe((0,a.Q)(this.destroy$),(0,R.p)(()=>!!this.editorInstance),(0,O.T)(()=>({width:this.el.clientWidth,height:this.el.clientHeight})),(0,B.F)((t,o)=>t.width===o.width&&t.height===o.height),(0,v.B)(50)).subscribe(()=>{this.editorInstance.layout()})})}setValue(){if(this.editorInstance){if(this.nzFullControl&&this.value)return void(0,l.R8)("should not set value when you are using full control mode! It would result in ambiguous data flow!");if("normal"===this.nzEditorMode)if(this.modelSet){const t=this.editorInstance.getModel();this.preservePositionAndSelections(()=>t.setValue(this.value))}else this.editorInstance.setModel(monaco.editor.createModel(this.value,this.editorOptionCached.language)),this.modelSet=!0;else if(this.modelSet){const t=this.editorInstance.getModel();this.preservePositionAndSelections(()=>{t.modified.setValue(this.value),t.original.setValue(this.nzOriginalText)})}else{const t=this.editorOptionCached.language;this.editorInstance.setModel({original:monaco.editor.createModel(this.nzOriginalText,t),modified:monaco.editor.createModel(this.value,t)}),this.modelSet=!0}}}preservePositionAndSelections(t){if(!this.editorInstance)return void t();const o=this.editorInstance.getPosition(),r=this.editorInstance.getSelections();t(),o&&this.editorInstance.setPosition(o),r&&this.editorInstance.setSelections(r)}setValueEmitter(){const t="normal"===this.nzEditorMode?this.editorInstance.getModel():this.editorInstance.getModel().modified;this.onDidChangeContentDisposable=t.onDidChangeContent(()=>{this.emitValue(t.getValue())})}emitValue(t){this.value!==t&&(this.value=t,this.ngZone.run(()=>{this.onChange(t)}))}updateOptionToMonaco(){this.editorInstance&&this.editorInstance.updateOptions({...this.editorOptionCached})}static#t=this.\u0275fac=function(o){return new(o||e)(i.rXU(F),i.rXU(i.SKi),i.rXU(i.aKT),i.rXU($.OD))};static#i=this.\u0275cmp=i.VBU({type:e,selectors:[["nz-code-editor"]],inputs:{nzEditorMode:"nzEditorMode",nzOriginalText:"nzOriginalText",nzLoading:"nzLoading",nzFullControl:"nzFullControl",nzToolkit:"nzToolkit",nzEditorOption:"nzEditorOption"},outputs:{nzEditorInitialized:"nzEditorInitialized"},exportAs:["nzCodeEditor"],standalone:!0,features:[i.Jv_([{provide:P.kq,useExisting:(0,i.Rfq)(()=>e),multi:!0}]),i.aNF],decls:2,vars:2,consts:[[1,"ant-code-editor-loading"],[1,"ant-code-editor-toolkit"],[3,"ngTemplateOutlet"]],template:function(o,r){1&o&&i.DNE(0,S,2,0,"div",0)(1,j,2,1,"div",1),2&o&&(i.vxM(0,r.nzLoading?0:-1),i.R7$(),i.vxM(1,r.nzToolkit?1:-1))},dependencies:[U.a,_.T3],encapsulation:2,changeDetection:0})}return(0,f.Cg)([(0,c.H3)()],e.prototype,"nzLoading",void 0),(0,f.Cg)([(0,c.H3)()],e.prototype,"nzFullControl",void 0),e})(),V=(()=>{class e{static#t=this.\u0275fac=function(o){return new(o||e)};static#i=this.\u0275mod=i.$C({type:e});static#e=this.\u0275inj=i.G2t({imports:[M]})}return e})()},82983:!1}]);